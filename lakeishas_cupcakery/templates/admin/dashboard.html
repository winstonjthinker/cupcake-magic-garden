{% extends "admin/base.html" %}
{% load i18n static %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'admin/css/dashboard.css' %}">
<!-- Load your React app's CSS here if you have any -->
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<style>
    /* Reset some admin styles that might interfere with React */
    #content {
        margin: 0;
        padding: 0;
    }
    
    #content-main {
        padding: 0;
        margin: 0;
    }
    
    /* Make the React app take full width and height */
    #root {
        min-height: 100vh;
        width: 100%;
        display: flex;
        flex-direction: column;
    }
    
    /* Ensure proper spacing for the admin header */
    .main-header {
        margin-bottom: 0 !important;
    }
    
    /* Hide Django's default content header */
    .content-header {
        display: none;
    }
</style>
{% endblock %}

{% block branding %}
<h1 id="site-name">
    <a href="{% url 'admin_dashboard' %}">Lakeisha's Cupcakery Admin</a>
</h1>
{% endblock %}

{% block breadcrumbs %}
<nav class="breadcrumbs">
    <a href="{% url 'admin_dashboard' %}">{% trans 'Home' %}</a>
    {% if title %}&rsaquo; {{ title }}{% endif %}
</nav>
{% endblock %}

{% block content %}
<!-- This div is where the React app will mount -->
<div id="root"></div>
{% endblock %}

{% block footer %}
{{ block.super }}
<!-- Load the React app's JavaScript -->
<script>
    // Make Django's CSRF token available to React
    window.django = window.django || {};
    window.django.csrfToken = '{{ csrf_token }}';
    
    // Add CSRF token to all fetch requests
    const originalFetch = window.fetch;
    window.fetch = function(resource, options = {}) {
        // Only add CSRF token to same-origin requests
        if (!/^https?:\/\//.test(resource) || new URL(resource, window.location.origin).origin === window.location.origin) {
            options.headers = {
                ...options.headers,
                'X-CSRFToken': '{{ csrf_token }}',
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            };
        }
        return originalFetch(resource, options);
    };
</script>

<!-- Load the compiled React app -->
<script src="{% static 'js/admin.js' %}"></script>
{% endblock %}
